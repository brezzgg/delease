vars:
  build-dir: ./build
  build-path: ./build/delease

do: [test, build]

tasks:
  build:
    cmds: 
      - run: |
          rm ${{build-dir}}/* -f
          GOOS=windows GOARCH=${{os.arch}} go build -o ${{build-path}}.exe . & \
          GOOS=linux GOARCH=${{os.arch}} go build -o ${{build-path}} . & \
          wait
  run:
    before: ["build"]
    cmds:
      - os: windows
        run: "${{build-path}}.exe ${{os.args}}"
      - os: linux
        run: "${{build-path}} ${{os.args}}"
  test:
    cmds:
      - go test -count=1 ./...
  lint:
    cmds:
      - run: |
          golangci-lint run ./...
  debug:
    cmds:
      - run: |
          rm -f ./__debug_bin*
          dlv debug . \
            --headless --listen=127.0.0.1:38697 \
            --api-version=2 -- ${{os.args}}
